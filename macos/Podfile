# SpaceSaver macOS Podfile
# Run 'pod install' in this directory to install dependencies
# Designed for macOS 15+ on Apple Silicon M2

require_relative '../node_modules/react-native-macos/scripts/react_native_pods'

# macOS 15 (Sequoia) minimum deployment target
platform :macos, '15.0'

# Ensure we're using the correct architecture for Apple Silicon
ENV['SWIFT_SWIFT_VERSION'] ||= '5'

prepare_react_native_project!

target 'SpaceSaverApp-macOS' do
  use_react_native_macos!

  # Add any additional pods here
  # pod 'SomePod', '~> 1.0'
end

post_install do |installer|
  react_native_post_install(installer)
  
  # Fix Xcode 15+ compatibility and Apple Silicon M2 settings
  installer.pods_project.targets.each do |target|
    target.build_configurations.each do |config|
      # Set deployment target to macOS 15
      config.build_settings['MACOSX_DEPLOYMENT_TARGET'] = '15.0'
      
      # Apple Silicon M2 architecture settings
      config.build_settings['ARCHS'] = 'arm64'
      config.build_settings['ONLY_ACTIVE_ARCH'] = 'YES'
      
      # Exclude x86_64 for simulator on Apple Silicon
      config.build_settings['EXCLUDED_ARCHS[sdk=macosx*]'] = 'i386'
      
      # Fix for Xcode 15 DT_TOOLCHAIN_DIR issue
      if config.build_settings['IPHONEOS_DEPLOYMENT_TARGET']
        config.build_settings.delete('IPHONEOS_DEPLOYMENT_TARGET')
      end
      
      # Enable module stability for Swift
      config.build_settings['BUILD_LIBRARY_FOR_DISTRIBUTION'] = 'YES'
      
      # Code signing settings (ad-hoc for development)
      config.build_settings['CODE_SIGN_IDENTITY'] = '-'
      config.build_settings['CODE_SIGNING_ALLOWED'] = 'NO'
      
      # Suppress warnings for dependencies
      config.build_settings['GCC_WARN_INHIBIT_ALL_WARNINGS'] = 'YES'
    end
  end
  
  # Set Swift version for all targets
  installer.pods_project.build_configurations.each do |config|
    config.build_settings['SWIFT_VERSION'] = '5.0'
  end
end
